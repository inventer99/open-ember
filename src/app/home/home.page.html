<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Open Ember
    </ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/pairing">
        Pair
        <ion-icon slot="end" name="add-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-list *ngIf="(device.all$ | ngrxPush).length; else noDevices">
    <ion-card
      *ngFor="let currentDevice of device.all$ | ngrxPush"
      (click)="router.navigate(['/device', currentDevice.deviceId])"
    >
      <ion-card-header>
        <ion-card-title>{{ currentDevice.name }}</ion-card-title>
      </ion-card-header>

      <ion-card-content *ngIf="device.getReads(currentDevice.deviceId) as reads">
        <ion-text *ngrxLet="reads.currentTemp$; let currentTemp">
          Current
          <ion-icon name="thermometer-outline"></ion-icon>
          : {{ currentTemp | temperature }}
        </ion-text>

        <ion-text *ngrxLet="reads.targetTemp$; let targetTemp">
          Target
          <ion-icon name="thermometer-outline"></ion-icon>
          : {{ targetTemp | temperature }}
        </ion-text>

        <ion-text *ngrxLet="reads.currentBattery$; let currentBattery">
          {{ currentBattery | percent }}
          <ng-container [ngSwitch]="currentBattery | devicePowerState">
            <ion-icon *ngSwitchCase="DevicePowerState.Charging" name="battery-charging-outline"></ion-icon>
            <ion-icon *ngSwitchCase="DevicePowerState.Dead" name="battery-dead-outline"></ion-icon>
            <ion-icon *ngSwitchCase="DevicePowerState.Half" name="battery-half-outline"></ion-icon>
            <ion-icon *ngSwitchCase="DevicePowerState.Full" name="battery-full-outline"></ion-icon>
          </ng-container>
        </ion-text>

        <ion-text *ngrxLet="reads.ledColor$; let ledColor">
          <ion-icon name="color-filter-outline"></ion-icon>
          <svg style="height: 1em;" viewBox="0 0 1 1" xmlns="http://www.w3.org/2000/svg">
            <circle r="0.5" cx="0.5" cy="0.5" [style.fill]="asRgbaString(ledColor)"/>
          </svg>
        </ion-text>
      </ion-card-content>
    </ion-card>
  </ion-list>

  <ng-template #noDevices>
    <ion-grid>
      <ion-row>
        <ion-col>
          <ion-text class="ion-text-center">
            <p>You have no paired devices.<p>
            <p>To get started, click "Pair <ion-icon name="add-outline"></ion-icon>".<p>
          </ion-text>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ng-template>
</ion-content>
